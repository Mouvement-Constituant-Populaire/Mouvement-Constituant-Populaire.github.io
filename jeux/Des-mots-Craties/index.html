<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>MCP - Des-mots-Craties</title>	
		<link href="style.css" rel="stylesheet" />				
	</head>
	<body>
	 <h1> Des-mots-Craties</h1>
	 		 
	 <h2>Lancer une partie !</h2>
	 	 
	 <form id="options_partie" method="post">
	    <fieldset>
		    <legend>Choisissez votre niveau de difficulté :</legend>
			<div>
				<input type="checkbox" id="niv1" name="niv1" checked />
				<label for="niv1">Niveau 1</label>
			</div>
			<div>
				<input type="checkbox" id="niv2" name="niv2" />
				<label for="niv2">Niveau 2</label>
			</div>
			<div>
				<input type="checkbox" id="niv3" name="niv3" />
				<label for="niv3">Niveau 3</label>
			</div>
	    </fieldset> 
	 </form>
	
	 <br/>
	 <button onclick="creerPartie()" class="button" >Créer la partie</button>
	 <br/>
	 <br/>
	 
	 <div id="listeLiensParties">
	 </div>
		 
	 L'ensemble des documents, codes sources et images sont distribués sous la licence CC-BY-SA V2.0.
	 https://creativecommons.org/licenses/by-sa/2.0/fr/deed.fr 
	 
	 Sauf pour les contenus dont il est fait mention explicitement d'une autre licence ou d'un copyright tiers.
	
	</body>	
	
	<script>	
	//TODO: Ajouter une colonne "niveau" pour chaque mot. Ensuite, il faudra ignorer la première case dans carte.html.
	//TODO: créer un game.html pour héberger la partie, avec la liste des tirages dans l'url, et la carte courante
	//avec des boutons pour faire "carte suivante" et "carte précédente" 
	
	function choisirMot(niv1,niv2,niv3) 
	{
		if(niveau = 1) return Math.floor(Math.random() * 34) + 4;
		else if(niveau = 2) return Math.floor(Math.random() * 32) + 44;
		else return Math.floor(Math.random() * 72) + 4;
	}
	
	var numeroMot = 0;
			
	function creerPartie(niveau) 
	{
		let listeLiensParties = document.getElementById("listeLiensParties");
		
		let niv1ChBx = document.getElementById("niv1"); 		
		let niv2ChBx = document.getElementById("niv2");		
		let niv3ChBx = document.getElementById("niv3");
		
		let niv1 = niv1ChBx.checked;		
		let niv2 = niv2ChBx.checked;				
		let niv3 = niv2ChBx.checked;
		
		let url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQCQIE7mV0sWHvabQll9uWG-P7QZNrB3mxBCQR-rZGRZ9eX2alM_eMl6H3zTt9cP9DLMJQGLZwrOVDW/pub?gid=0&single=true&output=csv";
 
		let indexMotsPossibles = new Array();
		
		fetch(url)
			.then(response => response.text())
			.then(data => 
				{
					console.log(data);
					let rows = data.split("\n");
					rows.foreach(function (item, index, array) {
						console.log(item);
						cells = item.split(",");
						if( (cells[9] != "") && (((cells[0] == 1) && niv1) || ((cells[0] == 2) && niv2) || ((cells[0] == 3) && niv3)) )indexMotsPossibles.push(index);
					});
					
				})
			.catch(error => console.log(error));		
		
		console.log("indexMotsPossibles : " );
		console.log(indexMotsPossibles);
		
		let tirages = new Array();
		
		tirages.push(indexMotsPossibles[Math.floor(Math.random() * indexMotsPossibles.length)]);
		
		let i = 0;
		while(tirages.length < 20 && i < 60) 
		{
			let mot = indexMotsPossibles[Math.floor(Math.random() * indexMotsPossibles.length)];
			//console.log(tirages.length);			
			//console.log(mot);
			
			let pasEncoreChoisi = true;
			
			tirages.forEach(function (item, index, array) {
			if(item == mot) pasEncoreChoisi = false;
			//console.log(pasEncoreChoisi);
			});
			
			if (pasEncoreChoisi) tirages.push(mot);		
			
			i++;		
		}
		
		niveau = "1";
		game_url = '<a href= "https://mouvement-constituant-populaire.github.io/jeux/Des-mots-Craties/partie.html?niveaux=' + niveau + '&cartes='; 
				
		tirages.forEach(function (item, index, array) {
			let n = index + 1;	
			game_url += item + ','; 
		});
		
		game_url.slice(0, -1);
		game_url += '" target="_blank">Lien vers la partie</a>';
		
		listeLiensParties.innerHTML += game_url;
		listeLiensParties.innerHTML += "<br/> ";
	}	
	
    </script>
</html>
